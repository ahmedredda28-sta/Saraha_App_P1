import crypto from 'crypto';
import { ENC_BYTE } from '../../../config/config.service.js';
const IV_LENGTH = 16;
const ENCRYPTION_SECRET_KEY = Buffer.from(ENC_BYTE); // must be 32 bytes

export const encrypt = (text) => {
  const iv = crypto.randomBytes(IV_LENGTH);
  console.log({ ENCRYPTION_SECRET_KEY, iv });

  const cipher = crypto.createCipheriv('aes-256-cbc', ENCRYPTION_SECRET_KEY, iv);
  console.log(cipher);

  let encryptedData = cipher.update(text, 'utf-8', 'hex');
  console.log(encryptedData);
  encryptedData += cipher.final('hex');

  return `${iv.toString('hex')}:${encryptedData}`;
}

export const decrypt = (encryptedData) => {
  const [iv, encryptedText] = encryptedData.split(":"); // []

  const binaryLikeIv = Buffer.from(iv, 'hex');
  const decipher = crypto.createDecipheriv('aes-256-cbc', ENCRYPTION_SECRET_KEY, binaryLikeIv);

  let decryptedData = decipher.update(encryptedText, 'hex', 'utf-8');
  decryptedData += decipher.final('utf-8');

  return decryptedData;
}